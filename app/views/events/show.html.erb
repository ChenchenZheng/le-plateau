<div class="row background-image d-flex justify-content-center align-items-center" style="background-image: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('<%= @event.boardgame.photo.attached? ? cl_image_path(@event.boardgame.photo.key) : asset_path('explodingkittens.jpg') %>')">
  <h1 class="mb-5 text-center"><%= @event.boardgame.name %></h1>
</div>

<div class="mt-5 d-flex justify-content-between">
  <div class="event-details">
    <div class="cta-group d-flex justify-content-between align-items-center mb-4">
      <h2>Description de l’événement</h2>

      <%= link_to "Chatroom", event_chatroom_path(@event), class: 'btn-flat clair' %>
      <% if current_user == @event.user %>
        <%= render 'shared/modal_liste_participants', user: @event.user, request: @request, event: @event, participation: @event.participations, boardgame: @boardgame %>
      <% else %>
        <div>
          <% if @event.users.include?(current_user) %>
            <% if @current_user_participation.statut == "Declined" %>
              <h6 class ="text-danger mb-0">Décliné <i class="far fa-times-circle"></i></h6>
            <% elsif @current_user_participation.statut == "Accepted"%>
              <h6 class ="text-success mb-0">Accepté <i class="far fa-check-circle"></i></h6>
              <%= link_to "Annuler ma participation", participation_path(@current_user_participation), method: :delete, data: {confirm: "Êtes-vous sûr ?"}, class: 'text-warning text-decoration-none' %>
            <% elsif @current_user_participation.statut == "Pending"%>
              <h6 class="text-warning mb-0">Statut: en attente <i class="far fa-clock"></i></h6>
              <%= link_to "Annuler ma participation", participation_path(@current_user_participation), method: :delete, data: {confirm: "Êtes-vous sûr ?"}, class: 'text-warning text-decoration-none' %>
            <% end %>
          <% else %>
            <%= render 'shared/modal_rejoindre' %>
          <% end %>
        </div>
      <% end %>
    </div>

    <div class="d-flex align-items-baseline">
      <i class="fas fa-calendar-alt icon-card pink mr-2"></i>
      <p class="mr-2"><%= @event.start_time.strftime("%e %b %l:%M") %> - <%= @event.end_time.strftime("%H:%M") %></p>
      <i class="fas fa-users icon-card orange mr-2"></i>
      <p class="mr-2"><%= @event.participations.select { |p| p.statut == "Accepted" }.count + 1 %> / <%= @event.nb_players %></p>
      <i class="fas fa-map-marker-alt icon-card blue mr-2"></i>
      <p class="mr-2"><%= @event.address %></p>
    </div>

    <p><%= @event.description %></p>
  </div>

  <div class="event-profile mt-5">
    <%= link_to user_path(@event.user), class:'text-white text-decoration-none' do %>
        <%= @event.user.photo.attached? ? cl_image_tag(@event.user.photo.key) : image_tag('user.jpg') %>
        <h5 class="text-center"><%= @event.user.first_name %> <%= @event.user.last_name %></h5>
        <ul>
          <li><%= Time.now.year - @event.user.birth_date.year %> ans</li>
          <% if @event.user.events.count == 0 || @event.user.events.count == 1 %>
            <li>Organisé <%= @event.user.events.count %> jeu</li>
          <% else %>
            <li>Organisé <%= @event.user.events.count %> jeux</li>
          <% end %>

          <% if @event.user.participations.select { |p| p.statut == "Accepted"}.count == 0 %>
            <li>Aucune participation</li>
          <% elsif @event.user.participations.select { |p| p.statut == "Accepted"}.count == 1 %>
            <li>Participé à 1 jeu</li>
          <% else %>
            <li>Participé aux <%= @event.user.participations.select { |p| p.statut == "Accepted"}.count %> jeux</li>
          <% end %>
        </ul>
    <% end %>
  </div>
</div>

<em><p>Invitez vos amis</p></em>
<div>
  <%= link_to "https://wa.me/?text=Viens%20jouer%20à%20#{@event.boardgame.name}%20avec%20moi%20ici%20https://www.leplateau.app/events/#{@event.id}", target: '_blank' do %>
    <i class="fab fa-whatsapp" style="margin-right: 25px; font-size: x-large; color: #25D366"></i>
  <% end %>
  <%= link_to "mailto:?subject=Hey! Faisons une partie de #{@event.boardgame.name}&body=Rejoins%20moi%20sur%20cette%20partie%20https://www.leplateau.app/events/#{@event.id}", target: '_blank' do %>
    <i class="fas fa-envelope" style="font-size: x-large; color: aliceblue"></i>
  <% end %>
</div>

<div class="game-card d-flex justify-content-between mt-5">
  <div class="game-infos-text">
    <h2><%= @event.boardgame.name %></h2>
    <p><%= @event.boardgame.description %></p>
  </div>

  <div class="game-infos-icons">
    <div class="d-flex align-items-baseline">
      <i class="fas fa-puzzle-piece icon-card seablue mr-2"></i>
      <p><%= @event.boardgame.category %></p>
    </div>
    <div class="d-flex align-items-baseline">
      <i class="fas fa-signal icon-card violet mr-2"></i>
      <p><%= @event.boardgame.level %></p>
    </div>
    <div class="d-flex align-items-baseline">
      <i class="fas fa-clock icon-card orange mr-2"></i>
      <p><%= @event.boardgame.duration %> min</p>
    </div>
  </div>
</div>
